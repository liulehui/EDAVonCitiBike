#df <- read.csv('./201806-citibike-tripdata.csv')
load("bike.RData")
df = data_18_6
df <- df %>% mutate(minute=tripduration/60)
df <- subset(df,minute<120 & minute>0)
summary = df %>%
group_by(start.station.id) %>%
summarise(lat=as.numeric(start.station.latitude[1]),
long=as.numeric(start.station.longitude[1]),
name=start.station.name[1],
n.trips=n())
leaflet(summary) %>%setView(-74.00, 40.71, zoom = 12) %>%
addProviderTiles("CartoDB.Positron") %>%
addCircles(lng = ~long, lat = ~lat, col = "#fb6a4a")
id = which(df$start.station.latitude > 45)
df = df[-id,]
df$factor_year = as.factor(df$birth.year)
summary_18_6 = df %>% group_by(factor_year) %>%
summarise(Freq = n()) %>%
arrange(desc(Freq))
summary_18_6 = mutate(summary_18_6, time = rep("201806", nrow(summary_18_6)))
ggplot(summary_18_6, aes(x = factor_year, y = Freq)) + geom_point(col = "#fb6a4a") +
coord_flip() + xlab("user's birth year") +
ggtitle("Frequency of Citi Bike users' birth year in 2018/6")
df_2month = full_join(summary_18_6, summary_17_6, by = "factor_year")
df_3month = full_join(df_2month, summary_16_6, by = "factor_year")
t1 = data.frame(factor_year = df_3month$factor_year,Freq = df_3month$Freq.x, time = df_3month$time.x)
t2 = data.frame(factor_year = df_3month$factor_year,Freq = df_3month$Freq.y, time = df_3month$time.y)
t3 = data.frame(factor_year = df_3month$factor_year,Freq = df_3month$Freq, time = df_3month$time)
tf = rbind(t1,t2,t3)
ggplot(tf, aes(x = factor_year, y = Freq, color = as.factor(time))) + geom_point() +
coord_flip() + xlab("user's birth year") +
ggtitle("Frequency of Citi Bike users' birth year in different months")+
labs(fill="Time")
set.seed(321)
index = sample(nrow(data_18_6), round(nrow(data_18_6)*0.001))
sample = data_18_6[index,]
g = ggplot(sample, aes(birth.year,minute))
g + geom_point(alpha = 0.5) + ylab("trip duration (in min)") +
xlab("users' birth year") + ggtitle("Scatterplot of uses' birth year and trip duration (in sec) in Jun 2018")
set.seed(321)
index = sample(nrow(df), round(nrow(df)*0.001))
sample = df[index,]
g = ggplot(sample, aes(birth.year,minute))
g + geom_point(alpha = 0.5) + ylab("trip duration (in min)") +
xlab("users' birth year") + ggtitle("Scatterplot of uses' birth year and trip duration (in sec) in Jun 2018")
set.seed(321)
index = sample(nrow(df), round(nrow(df)*0.001))
sample = df[index,]
g = ggplot(sample, aes(birth.year,minute))
g + geom_point(alpha = 0.5, col = "#fb6a4a") + ylab("trip duration (in min)") +
xlab("users' birth year") + ggtitle("Scatterplot of uses' birth year and trip duration (in sec) in Jun 2018")
nrow(df)
## get station info
station.info <- data_18_6 %>%
group_by(start.station.id) %>%
summarise(lat=as.numeric(start.station.latitude[1]),
long=as.numeric(start.station.longitude[1]),
name=start.station.name[1],
n.trips=n())
leaflet(station.info) %>%setView(-74.00, 40.71, zoom = 12) %>%
addProviderTiles("CartoDB.Positron") %>%
addHeatmap(lng=~long, lat=~lat, intensity = ~n.trips, radius = 7, gradient = "YlGnBu")
pal = colorNumeric(
palette="YlOrRd",
domain = station.info$n.trips
)
leaflet(station.info) %>%setView(-74.00, 40.71, zoom = 12) %>%
leaflet::addProviderTiles("CartoDB.Positron") %>%
leaflet::addCircles(lng = ~long, lat = ~lat, color =~pal(n.trips)) %>%
leaflet::addLegend("bottomright", pal = pal, value = ~n.trips, title = "Num of Trips (2018.6)")
leaflet(station.info) %>%setView(-74.00, 40.71, zoom = 12) %>%
leaflet::addProviderTiles("CartoDB.Positron") %>%
leaflet::addCircles(lng = ~long, lat = ~lat, color =~pal(n.trips)) %>%
leaflet::addLegend("bottomright", pal = -pal, value = ~n.trips, title = "Num of Trips (2018 June)")
leaflet(station.info) %>%setView(-74.00, 40.71, zoom = 12) %>%
leaflet::addProviderTiles("CartoDB.Positron") %>%
leaflet::addCircles(lng = ~long, lat = ~lat, color =~pal(n.trips)) %>%
leaflet::addLegend("bottomright", pal = pal, value = ~n.trips, title = "Num of Trips (2018 June)")
colorNumeric()
?colorNumeric
## get station info
station.info <- data_18_6 %>%
group_by(start.station.id) %>%
summarise(lat=as.numeric(start.station.latitude[1]),
long=as.numeric(start.station.longitude[1]),
name=start.station.name[1],
n.trips=n())
pal = colorNumeric(
palette="YlOrRd",
domain = station.info$n.trips,
reverse = T
)
leaflet(station.info) %>%setView(-74.00, 40.71, zoom = 12) %>%
leaflet::addProviderTiles("CartoDB.Positron") %>%
leaflet::addCircles(lng = ~long, lat = ~lat, color =~pal(n.trips)) %>%
leaflet::addLegend("bottomright", pal = pal, value = ~n.trips, title = "Num of Trips (2018 June)")
## get station info
station.info <- data_18_6 %>%
group_by(start.station.id) %>%
summarise(lat=as.numeric(start.station.latitude[1]),
long=as.numeric(start.station.longitude[1]),
name=start.station.name[1],
n.trips=n())
pal = colorNumeric(
palette="YlOrRd",
domain = -station.info$n.trips,
reverse = T
)
leaflet(station.info) %>%setView(-74.00, 40.71, zoom = 12) %>%
leaflet::addProviderTiles("CartoDB.Positron") %>%
leaflet::addCircles(lng = ~long, lat = ~lat, color =~pal(n.trips)) %>%
leaflet::addLegend("bottomright", pal = pal, value = ~n.trips, title = "Num of Trips (2018 June)")
## get station info
station.info <- data_18_6 %>%
group_by(start.station.id) %>%
summarise(lat=as.numeric(start.station.latitude[1]),
long=as.numeric(start.station.longitude[1]),
name=start.station.name[1],
n.trips=n())
pal = colorNumeric(
palette="YlOrRd",
domain = station.info$n.trips,
reverse = T
)
leaflet(station.info) %>%setView(-74.00, 40.71, zoom = 12) %>%
leaflet::addProviderTiles("CartoDB.Positron") %>%
leaflet::addCircles(lng = ~long, lat = ~lat, color =~pal(n.trips)) %>%
leaflet::addLegend("bottomright", pal = pal, value = ~n.trips, title = "Num of Trips (2018 June)")
## get station info
station.info <- data_18_6 %>%
group_by(start.station.id) %>%
summarise(lat=as.numeric(start.station.latitude[1]),
long=as.numeric(start.station.longitude[1]),
name=start.station.name[1],
n.trips=n())
pal = colorNumeric(
palette="YlOrRd",
domain = c(max(station.info$n.trips), min(station.info$n.trips)),
reverse = T
)
leaflet(station.info) %>%setView(-74.00, 40.71, zoom = 12) %>%
leaflet::addProviderTiles("CartoDB.Positron") %>%
leaflet::addCircles(lng = ~long, lat = ~lat, color =~pal(n.trips)) %>%
leaflet::addLegend("bottomright", pal = pal, value = ~n.trips, title = "Num of Trips (2018 June)")
c(max(station.info$n.trips), min(station.info$n.trips))
## get station info
station.info <- data_18_6 %>%
group_by(start.station.id) %>%
summarise(lat=as.numeric(start.station.latitude[1]),
long=as.numeric(start.station.longitude[1]),
name=start.station.name[1],
n.trips=n())
pal = colorNumeric(
palette="YlOrRd",
#domain = c(max(station.info$n.trips), min(station.info$n.trips)),
domain = station.info$n.trips,
reverse = T
)
leaflet(station.info) %>%setView(-74.00, 40.71, zoom = 12) %>%
leaflet::addProviderTiles("CartoDB.Positron") %>%
leaflet::addCircles(lng = ~long, lat = ~lat, color =~pal(n.trips)) %>%
leaflet::addLegend("bottomright", pal = pal, value = ~n.trips, title = "Num of Trips (2018 June)")
## get station info
station.info <- data_18_6 %>%
group_by(start.station.id) %>%
summarise(lat=as.numeric(start.station.latitude[1]),
long=as.numeric(start.station.longitude[1]),
name=start.station.name[1],
n.trips=n())
pal = colorNumeric(
palette="YlOrRd",
#domain = c(max(station.info$n.trips), min(station.info$n.trips)),
#domain = station.info$n.trips,
domain = c(min(station.info$n.trips), max(station.info$n.trips)),
reverse = T
)
leaflet(station.info) %>%setView(-74.00, 40.71, zoom = 12) %>%
leaflet::addProviderTiles("CartoDB.Positron") %>%
leaflet::addCircles(lng = ~long, lat = ~lat, color =~pal(n.trips)) %>%
leaflet::addLegend("bottomright", pal = pal, value = ~n.trips, title = "Num of Trips (2018 June)")
## get station info
station.info <- data_18_6 %>%
group_by(start.station.id) %>%
summarise(lat=as.numeric(start.station.latitude[1]),
long=as.numeric(start.station.longitude[1]),
name=start.station.name[1],
n.trips=n())
pal = colorNumeric(
palette="YlOrRd",
#domain = c(max(station.info$n.trips), min(station.info$n.trips)),
#domain = station.info$n.trips,
domain = c(min(station.info$n.trips), max(station.info$n.trips)),
reverse = T
)
leaflet(station.info) %>%setView(-74.00, 40.71, zoom = 12) %>%
leaflet::addProviderTiles("CartoDB.Positron") %>%
leaflet::addCircles(lng = ~long, lat = ~lat, color =~pal(n.trips)) %>%
leaflet::addLegend("bottomright", pal = pal, value = ~rev(n.trips), title = "Num of Trips (2018 June)")
## get station info
station.info <- data_18_6 %>%
group_by(start.station.id) %>%
summarise(lat=as.numeric(start.station.latitude[1]),
long=as.numeric(start.station.longitude[1]),
name=start.station.name[1],
n.trips=n())
pal = colorNumeric(
palette="YlOrRd",
#domain = c(max(station.info$n.trips), min(station.info$n.trips)),
#domain = station.info$n.trips,
domain = c(min(station.info$n.trips), max(station.info$n.trips)),
reverse = F
)
leaflet(station.info) %>%setView(-74.00, 40.71, zoom = 12) %>%
leaflet::addProviderTiles("CartoDB.Positron") %>%
leaflet::addCircles(lng = ~long, lat = ~lat, color =~pal(n.trips)) %>%
leaflet::addLegend("bottomright", pal = rev(pal), value = ~n.trips, title = "Num of Trips (2018 June)")
rev(pal)
pal
## get station info
station.info <- data_18_6 %>%
group_by(start.station.id) %>%
summarise(lat=as.numeric(start.station.latitude[1]),
long=as.numeric(start.station.longitude[1]),
name=start.station.name[1],
n.trips=n())
pal = colorNumeric(
palette="YlOrRd",
domain = station.info$n.trips
)
leaflet(station.info) %>%setView(-74.00, 40.71, zoom = 12) %>%
leaflet::addProviderTiles("CartoDB.Positron") %>%
leaflet::addCircles(lng = ~long, lat = ~lat, color =~pal(n.trips)) %>%
leaflet::addLegend("bottomright", pal = pal, value = ~n.trips, title = "Num of Trips (2018 June)")
## get station info
station.info <- data_18_6 %>%
group_by(start.station.id) %>%
summarise(lat=as.numeric(start.station.latitude[1]),
long=as.numeric(start.station.longitude[1]),
name=start.station.name[1],
n.trips=n())
pal = colorNumeric(
palette="YlOrRd",
domain = station.info$n.trips
)
leaflet(station.info) %>%setView(-74.00, 40.71, zoom = 12) %>%
leaflet::addProviderTiles("CartoDB.Positron") %>%
leaflet::addCircles(lng = ~long, lat = ~lat, color =~pal(n.trips)) %>%
leaflet::addLegend("bottomright", pal = pal, value = ~n.trips, title = "Num of Trips starting from this station")
## get station info
station.info <- data_18_6 %>%
group_by(start.station.id) %>%
summarise(lat=as.numeric(start.station.latitude[1]),
long=as.numeric(start.station.longitude[1]),
name=start.station.name[1],
n.trips=n())
pal = colorNumeric(
palette="YlOrRd",
domain = station.info$n.trips
)
leaflet(station.info) %>%setView(-74.00, 40.71, zoom = 12) %>%
leaflet::addProviderTiles("CartoDB.Positron") %>%
leaflet::addCircles(lng = ~long, lat = ~lat, color =~pal(n.trips)) %>%
leaflet::addLegend("bottomleft", pal = pal, value = ~n.trips, title = "Num of trips starting from this station")
colnames(data_18_6)
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(dplyr)
library(ggmap)
library(leaflet)
library(leaflet.extras)
#df <- read.csv('./201806-citibike-tripdata.csv')
load("bike.RData")
df = data_18_6
summary = df %>%
group_by(start.station.id) %>%
summarise(lat=as.numeric(start.station.latitude[1]),
long=as.numeric(start.station.longitude[1]),
name=start.station.name[1],
n.trips=n())
leaflet(summary) %>%setView(-74.00, 40.71, zoom = 8) %>%
addProviderTiles("CartoDB.Positron") %>%
addCircles(lng = ~long, lat = ~lat, col = "#fb6a4a")
id = which(df$start.station.latitude > 45)
df = df[-id,]
summary = df %>%
group_by(start.station.id) %>%
summarise(lat=as.numeric(start.station.latitude[1]),
long=as.numeric(start.station.longitude[1]),
name=start.station.name[1],
n.trips=n())
leaflet(summary) %>%setView(-74.00, 40.71, zoom = 2) %>%
addProviderTiles("CartoDB.Positron") %>%
addCircles(lng = ~long, lat = ~lat, col = "#fb6a4a")
id = which(df$start.station.latitude > 45)
df = df[-id,]
summary = df %>%
group_by(start.station.id) %>%
summarise(lat=as.numeric(start.station.latitude[1]),
long=as.numeric(start.station.longitude[1]),
name=start.station.name[1],
n.trips=n())
leaflet(summary) %>%setView(-74.00, 40.71, zoom = 5) %>%
addProviderTiles("CartoDB.Positron") %>%
addCircles(lng = ~long, lat = ~lat, col = "#fb6a4a")
#df <- read.csv('./201806-citibike-tripdata.csv')
load("bike.RData")
df = data_18_6
summary = df %>%
group_by(start.station.id) %>%
summarise(lat=as.numeric(start.station.latitude[1]),
long=as.numeric(start.station.longitude[1]),
name=start.station.name[1],
n.trips=n())
leaflet(summary) %>%setView(-74.00, 40.71, zoom = 5) %>%
addProviderTiles("CartoDB.Positron") %>%
addCircles(lng = ~long, lat = ~lat, col = "#fb6a4a")
#id = which(df$start.station.latitude > 45)
#df = df[-id,]
summary = df %>%
group_by(start.station.id) %>%
summarise(lat=as.numeric(start.station.latitude[1]),
long=as.numeric(start.station.longitude[1]),
name=start.station.name[1],
n.trips=n())
leaflet(summary) %>%setView(-74.00, 40.71, zoom = 5) %>%
addProviderTiles("CartoDB.Positron") %>%
addCircles(lng = ~long, lat = ~lat, col = "#fb6a4a")
#id = which(df$start.station.latitude > 45)
#df = df[-id,]
summary = df %>%
group_by(start.station.id) %>%
summarise(lat=as.numeric(start.station.latitude[1]),
long=as.numeric(start.station.longitude[1]),
name=start.station.name[1],
n.trips=n())
leaflet(summary) %>%setView(-74.00, 40.71, zoom = 6) %>%
addProviderTiles("CartoDB.Positron") %>%
addCircles(lng = ~long, lat = ~lat, col = "#fb6a4a")
#id = which(df$start.station.latitude > 45)
#df = df[-id,]
summary = df %>%
group_by(start.station.id) %>%
summarise(lat=as.numeric(start.station.latitude[1]),
long=as.numeric(start.station.longitude[1]),
name=start.station.name[1],
n.trips=n())
leaflet(summary) %>%setView(-74.10, 40.71, zoom = 6) %>%
addProviderTiles("CartoDB.Positron") %>%
addCircles(lng = ~long, lat = ~lat, col = "#fb6a4a")
#id = which(df$start.station.latitude > 45)
#df = df[-id,]
summary = df %>%
group_by(start.station.id) %>%
summarise(lat=as.numeric(start.station.latitude[1]),
long=as.numeric(start.station.longitude[1]),
name=start.station.name[1],
n.trips=n())
leaflet(summary) %>%setView(-74.50, 40.71, zoom = 6) %>%
addProviderTiles("CartoDB.Positron") %>%
addCircles(lng = ~long, lat = ~lat, col = "#fb6a4a")
#id = which(df$start.station.latitude > 45)
#df = df[-id,]
summary = df %>%
group_by(start.station.id) %>%
summarise(lat=as.numeric(start.station.latitude[1]),
long=as.numeric(start.station.longitude[1]),
name=start.station.name[1],
n.trips=n())
leaflet(summary) %>%setView(-75.50, 40.71, zoom = 6) %>%
addProviderTiles("CartoDB.Positron") %>%
addCircles(lng = ~long, lat = ~lat, col = "#fb6a4a")
#id = which(df$start.station.latitude > 45)
#df = df[-id,]
summary = df %>%
group_by(start.station.id) %>%
summarise(lat=as.numeric(start.station.latitude[1]),
long=as.numeric(start.station.longitude[1]),
name=start.station.name[1],
n.trips=n())
leaflet(summary) %>%setView(-75.50, 41.71, zoom = 6) %>%
addProviderTiles("CartoDB.Positron") %>%
addCircles(lng = ~long, lat = ~lat, col = "#fb6a4a")
#id = which(df$start.station.latitude > 45)
#df = df[-id,]
summary = df %>%
group_by(start.station.id) %>%
summarise(lat=as.numeric(start.station.latitude[1]),
long=as.numeric(start.station.longitude[1]),
name=start.station.name[1],
n.trips=n())
leaflet(summary) %>%setView(-75.50, 42.71, zoom = 6) %>%
addProviderTiles("CartoDB.Positron") %>%
addCircles(lng = ~long, lat = ~lat, col = "#fb6a4a")
#id = which(df$start.station.latitude > 45)
#df = df[-id,]
summary = df %>%
group_by(start.station.id) %>%
summarise(lat=as.numeric(start.station.latitude[1]),
long=as.numeric(start.station.longitude[1]),
name=start.station.name[1],
n.trips=n())
leaflet(summary) %>%setView(-74.00, 42.71, zoom = 6) %>%
addProviderTiles("CartoDB.Positron") %>%
addCircles(lng = ~long, lat = ~lat, col = "#fb6a4a")
#id = which(df$start.station.latitude > 45)
#df = df[-id,]
gender = data.frame(group = c("unkown", "male", "female"),
value = summary(as.factor(df$gender)))
pie = ggplot(gender, aes(x="", y = value, fill=group)) +
geom_bar(width = 1, stat="identity") +
coord_polar("y", start = 0)
blank_theme <- theme_minimal()+
theme(
axis.title.x = element_blank(),
axis.title.y = element_blank(),
panel.border = element_blank(),
panel.grid=element_blank(),
axis.ticks = element_blank(),
plot.title=element_text(size=14, face="bold")
)
library(memisc)
pie + scale_fill_manual(values=c("#999999", "#E69F00", "#56B4E9")) +
blank_theme + theme(axis.text.x=element_blank()) +
geom_text(aes(y = value/3 + c(0, cumsum(value)[-length(value)]),
label = c("10%","66%", "24%")), size=5)
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(dplyr)
library(ggmap)
library(leaflet)
library(leaflet.extras)
library(memisc)
gender = data.frame(group = c("unkown", "male", "female"),
value = summary(as.factor(df$gender)))
pie = ggplot(gender, aes(x="", y = value, fill=group)) +
geom_bar(width = 1, stat="identity") +
coord_polar("y", start = 0)
blank_theme <- theme_minimal()+
theme(
axis.title.x = element_blank(),
axis.title.y = element_blank(),
panel.border = element_blank(),
panel.grid=element_blank(),
axis.ticks = element_blank(),
plot.title=element_text(size=14, face="bold")
)
pie + scale_fill_manual(values=c("#fbb4ae", "#b3cde3", "#ccebc5")) +
blank_theme + theme(axis.text.x=element_blank()) +
geom_text(aes(y = value/3 + c(0, cumsum(value)[-length(value)]),
label = c("10%","66%", "24%")), size=5) +
ggtitle("Ratio of users' gender of Citi Bike ")
gender = data.frame(group = c("unkown", "male", "female"),
value = summary(as.factor(df$gender)))
pie = ggplot(gender, aes(x="", y = value, fill=group)) +
geom_bar(width = 1, stat="identity") +
coord_polar("y", start = 0)
blank_theme <- theme_minimal()+
theme(
axis.title.x = element_blank(),
axis.title.y = element_blank(),
panel.border = element_blank(),
panel.grid=element_blank(),
axis.ticks = element_blank(),
plot.title=element_text(size=10, face="bold")
)
pie + scale_fill_manual(values=c("#fbb4ae", "#b3cde3", "#ccebc5")) +
blank_theme + theme(axis.text.x=element_blank()) +
geom_text(aes(y = value/3 + c(0, cumsum(value)[-length(value)]),
label = c("10%","66%", "24%")), size=5) +
ggtitle("Ratio of users' gender of Citi Bike ")
gender = data.frame(group = c("unkown", "male", "female"),
value = summary(as.factor(df$gender)))
pie = ggplot(gender, aes(x="", y = value, fill=group)) +
geom_bar(width = 1, stat="identity") +
coord_polar("y", start = 0)
blank_theme <- theme_minimal()+
theme(
axis.title.x = element_blank(),
axis.title.y = element_blank(),
panel.border = element_blank(),
panel.grid=element_blank(),
axis.ticks = element_blank(),
plot.title=element_text(size=14, face="bold")
)
pie + scale_fill_manual(values=c("#fbb4ae", "#b3cde3", "#ccebc5")) +
blank_theme + theme(axis.text.x=element_blank()) +
geom_text(aes(y = value/3 + c(0, cumsum(value)[-length(value)]),
label = c("10%","66%", "24%")), size=5) +
ggtitle("Ratio of users' gender of Citi Bike ")
66/24
#NYCweather<-read.csv("./data/NYCweather.csv")
NYCweather<-read.csv("NYCweather.csv")
df$Date <- as.Date(df$starttime)
NYCweather$Date<-as.Date(NYCweather$Date)
df_weather <- inner_join(df,NYCweather,by="Date")
df_weather$Severe <- as.factor(df_weather$Severe)
hist(df_weather$Date, breaks="days", freq=TRUE)
ggplot(df_weather, aes(x=Date))+
geom_histogram(colour="white", fill="steelblue")+
ggtitle("Number of trips by day")
ggplot(df_weather, aes(x=Severe, y=))+
geom_bar(colour="white", fill="steelblue")+
ggtitle("Number of trips per day for severe and unsevere weather condition")
ggplot(data = df_weather,
aes(x = Windspeed, y = minute)) +
scale_x_continuous("Windspeed") +
scale_y_continuous("Average trip duration in minutes") +
ggtitle("Trip duration vs. Windspeed") +
stat_summary(fun.y="mean", geom = "line", colour="steelblue", size=1)
head(df_weather)
head(df)
